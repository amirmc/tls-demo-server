<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset='utf-8'>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <link rel="stylesheet" type="text/css" href="style.css" media="screen" />

    <title>OCaml-TLS demo server</title>
  </head>

  <body>
    <header>
      <div class="inner">
        <h1>OCaml-TLS demo Server</h1>
      </div>
    </header>

    <div id="main">

      <section id="info">
        <h3>Information</h3>
        <p>Data shown here is from your current handshake with our server (which uses the <a href="https://github.com/mirleft/ocaml-tls">OCaml-TLS</a> stack). We visualise the recorded TLS fragments on the wire between your browser and our server, as well as some internal state of our server. There is no recording of IP addresses whatsoever, only data on top of the TLS fragments. We keep this data for research purposes.</p>
      </section>

      <section id="demo">
        <h3>Showtime</h3>
        <table align="center" class="inner">
          <tr>
            <td>left</td>
            <td id="diagram">This should be a diagram! If you don't see it you need Javascript enabled</td>
            <td>right</td>
          </tr>
        </table>

      </section>

      <section id="disclaimer">
        <h3>Disclaimer</h3>
        <p>This demonstration uses <a href="https://github.com/bramp/js-sequence-diagrams">js-sequence-diagrams</a>, which depends on <a href="http://raphaeljs.com/">RaphaÃ«l</a> and <a href="http://underscorejs.org/">Underscore.js</a>.</p>
      </section>
      </div>

    <footer>
      <hr />
      <div class="inner">
        Running with <a href="https://github.com/mirage/ocaml-cohttp">cohttp</a> on <a href="http://www.openmirage.org">mirage</a>. Please report any issues to <a href="https://github.com/mirleft/ocaml-tls/issues">GitHub issue tracker</a>.
      </div>
    </footer>

    <script src="underscore-min.js"></script>
    <script src="raphael-min.js"></script>
    <script src="sequence-diagram-min.js"></script>

    <script type="text/javascript">

      function runme(diagram_div) {

        var data = "You->Me: Client Hello \n \
Note right of Me: bla \n \
Me->You: Server Hello \n \
Note right of Me: blubb \n \
Me->You: Certificate \n \
Note right of Me: blablubb \n \
Me->You: Server Hello Done \n \
You->Me: Client Key Exchange \n \
You->Me: Change Cipher Spec \n \
You-->Me: Finished \n \
Me->You: Change Cipher Spec \n \
Me-->You: Finished \n \
You-->Me: Application Data: GET / \n \
Me-->You: Application Data: This site"

        on_change();

        function on_change() {
          var diagram = Diagram.parse(data);

          var options = {
            theme: 'hand',
            scale: 1
          };

          diagram_div.innerHTML='';

          // Draw
          diagram.drawSVG(diagram_div, options);
        }
      }

      function initialise () {
        runme(document.getElementById('diagram'))
      };
    </script>
  <script>window.onload = initialise</script>
  </body>
</html>
